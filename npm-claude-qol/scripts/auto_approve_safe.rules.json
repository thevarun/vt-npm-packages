{
  "_doc_allow": "Broad program-head allows + specific deny patterns for safety. Redirect suffixes (2>&1, 2>/dev/null) handled by strip_safe_suffixes() in the hook.",
  "_doc_deny": "Blocks: privilege escalation, destructive rm, system modification, fork bombs, pipe-to-shell, mass kill, xargs rm, netcat, crontab, npm registry ops, git history destruction, npx arbitrary exec",
  "_doc_sensitive": "Protects: env files, crypto keys, SSH, cloud credentials, package registry configs, secrets/tokens, Docker/K8s configs",

  "allow_patterns": [
    "_comment: system info",
    "^(pwd|whoami|date)$",
    "^uname(\\s+-a)?$",
    "^which\\s+\\S+$",
    "^echo\\s+[^|;&]+$",

    "_comment: file inspection (sensitive path check still gates reads)",
    "^(cat|head|tail|wc|less|file|stat|du|df|xxd)\\s+[^|;&]+$",
    "^(ls|tree)(\\s+.*)?$",

    "_comment: version checks",
    "^(python3?|node|npm|pnpm|yarn|uv|docker|cargo|go)\\s+--?version$",

    "_comment: git — broad allow (deny patterns catch force-push, clean, etc)",
    "^git\\s+-C\\s+[^|;&]+\\s+\\S+(\\s+.*)?$",
    "^git\\s+\\S+(\\s+.*)?$",

    "_comment: npm/pnpm/yarn — broad allow (deny patterns catch publish, etc)",
    "^npm\\s+\\S+(\\s+.*)?$",
    "^pnpm\\s+\\S+(\\s+.*)?$",
    "^yarn\\s+\\S+(\\s+.*)?$",

    "_comment: npx — known-safe packages only (unknown packages fall to ask)",
    "^npx\\s+(tsc|eslint|prettier|vitest|jest|tsx|next|drizzle-kit|playwright|skills)(\\s+.*)?$",
    "^npx\\s+shadcn(@latest)?\\s+(add|init|diff)(\\s+.*)?$",
    "^npx\\s+(--yes\\s+)?create-next-app(@latest)?\\s+.*$",
    "^npx\\s+(--yes\\s+)?semantic-release\\s+--dry-run[^|;&]*$",
    "^npx\\s+supabase\\s+.*$",
    "^(PORT=\\d+\\s+)?npx\\s+playwright\\s+(test|install)\\b",

    "_comment: node — require file path (node -e falls to ask)",
    "^node\\s+(?!-)[\\w/.@-]+(\\.m?[jt]s)?(\\s+[^|;&]*)?$",

    "_comment: python — specific safe invocations (python -c falls to ask)",
    "^python3?\\s+-m\\s+(pytest|venv|http\\.server)(\\s+.*)?$",
    "^(pytest|ruff|mypy)(\\s+.*)?$",
    "^black\\s+--check(\\s+.*)?$",
    "^isort\\s+--check(\\s+.*)?$",
    "^uv\\s+(run|pip|sync|lock)(\\s+.*)?$",
    "^pip\\s+(list|show|freeze|install)(\\s+.*)?$",
    "^\\.?\\/?\\.?venv/bin/(python3?|pip|ruff|pytest|mypy|black|isort|uvicorn)(\\s+.*)?$",

    "_comment: rust/go",
    "^cargo\\s+(check|test|clippy|fmt|build)(\\s+.*)?$",
    "^go\\s+(test|vet|fmt|build)(\\s+.*)?$",

    "_comment: search/text tools",
    "^(jq|grep|rg|fd|ag|awk|cut|tr|diff|comm|sort|uniq)\\s+[^|;&]+$",
    "^find\\s+(?!.*-exec)[^|;&]+$",
    "^sed\\s+-n\\s+[^|;&]+$",
    "^xargs\\s+(grep|rg|cat|head|tail|wc|ls|file|stat)(\\s+[^|;&]*)?$",

    "_comment: image inspection",
    "^(sips|identify)\\s+[^|;&]+$",

    "_comment: network (read-only + localhost)",
    "^curl\\s+.*--head",
    "^curl\\s+-I\\s+",
    "^(ping|dig|nslookup|host)\\s+",
    "^curl\\s+(-[a-zA-Z]+\\s+)*https?://localhost[:/][^|;&]*$",
    "^curl\\s+-X\\s+(POST|GET|PUT|DELETE)\\s+['\"]?https?://localhost[:/][^|;&]*$",
    "^curl\\s+-s\\s+-o\\s+/dev/null\\s+-w\\s+[^|;&]*https?://[^|;&]*$",

    "_comment: filesystem",
    "^(mkdir|touch|cp|mv|rmdir)(\\s+.*)?$",
    "^chmod\\s+[0-6][0-7][0-7]\\s+[^|;&]+$",
    "^rm\\s+(?!.*(-r\\b|-rf\\b|-fr\\b|--recursive))[\\w.@-]+(\\s+[\\w.@-]+)*$",

    "_comment: docker — read-only only (run/exec/build fall to ask)",
    "^docker\\s+(ps|info|images|logs|inspect|port|top|stats)(\\s+[^|;&]*)?$",
    "^docker\\s+(network|volume)\\s+ls(\\s+[^|;&]*)?$",
    "^docker\\s+compose\\s+(ps|logs|config)(\\s+[^|;&]*)?$",

    "_comment: github CLI — broad allow",
    "^gh\\s+(pr|issue|repo|release|workflow|run|api|auth)(\\s+.*)?$",

    "_comment: process management",
    "^lsof\\s+(-[a-zA-Z]+\\s+)*-?i\\s*:?[\\d,:-]+",
    "^lsof\\s+-ti\\s*:?\\d+([,-]\\d+)*$",
    "^pgrep\\s+[^|;&]+$",
    "^ps\\s+aux.*$",
    "^sleep\\s+[0-9.]+$",
    "^kill\\s+\\d+(\\s+\\d+)*$",
    "^kill\\s+\\$\\(lsof\\s+-ti\\s*:?\\d+([,-]\\d+)*\\)$",

    "_comment: misc",
    "^test\\s+-[dfeL]\\s+[^|;&]+$",
    "^npm\\s+run\\s+dev(\\s+--\\s+-p\\s+\\d+)?\\s*(>\\s*(/tmp/[^|;&]+|/dev/null)\\s+)?2>&1\\s*&$"
  ],

  "deny_patterns": [
    "^sudo\\b",
    "^doas\\b",
    "(?<!git\\s)\\brm\\b.*\\s(-r\\b|-rf\\b|-fr\\b|--recursive\\b)",
    "(?<!git\\s)\\brm\\s+-[^\\s]*r",
    "^rm\\s+/$",
    "^rm\\s+/(etc|usr|var|bin|sbin|lib|boot|dev|proc|sys|root|home)\\b",
    "\\bmkfs\\.",
    "\\bdd\\b.*\\bof=",
    "\\bshutdown\\b",
    "\\breboot\\b",
    "\\bsystemctl\\s+(start|stop|restart|enable|disable)",
    "\\bchmod\\s+777",
    "\\bchown\\s+.*:.*\\s+/",
    ">\\s*/etc/",
    ">\\s*~/\\.",
    "\\bcurl\\b.*\\|.*\\b(bash|sh|zsh)\\b",
    "\\bwget\\b.*\\|.*\\b(bash|sh|zsh)\\b",
    "\\beval\\s+.*\\$\\(",
    ":(){ :|:& };:",
    "\\bfork\\s*bomb",
    "\\bkill\\s+-9\\s+-1",
    "\\bpkill\\s+-9",
    "\\bkillall\\b",
    "\\bxargs\\b.*\\brm\\b",
    "\\b(nc|ncat|netcat)\\b",
    "\\bcrontab\\s+-[er]",

    "_comment: npm registry operations",
    "^npm\\s+(publish|unpublish|deprecate|owner|access|dist-tag)\\b",

    "_comment: git history destruction",
    "^git\\s+push\\s+.*--force",
    "^git\\s+push\\s+--delete\\b",
    "^git\\s+reflog\\s+expire\\b",
    "^git\\s+clean\\s+.*-[a-z]*[fd]",

    "_comment: npx arbitrary execution",
    "^npx\\s+.*--exec\\b"
  ],

  "sensitive_paths": [
    "\\.env(?!\\.example)$",
    "\\.env\\.(?!example)",
    "\\.pem$",
    "\\.key$",
    "\\.crt$",
    "\\.p12$",
    "\\.pfx$",
    "id_rsa",
    "id_ed25519",
    "id_ecdsa",
    "\\.ssh/",
    "\\.gnupg/",
    "\\.git/config$",
    "\\.gitconfig$",
    "credentials",
    "\\.aws/",
    "\\.gcloud/",
    "\\.azure/",
    "\\.npmrc$",
    "\\.pypirc$",
    "\\.netrc$",
    "\\bsecrets?\\b",
    "\\bpassw(?:ord)?s?\\.(txt|json|env|yaml|yml|ini|conf|cfg)$",
    "\\btokens?\\.(txt|env|yaml|yml|ini|conf|cfg)$",
    "\\.docker/config\\.json",
    "\\.kube/config"
  ]
}
